"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _logger = _interopRequireDefault(require("../logger.js"));

var _lodash = _interopRequireDefault(require("lodash"));

const PHONE_NUMBER_PATTERN = /^[+]?[(]?[0-9]*[)]?[-\s.]?[0-9]*[-\s.]?[0-9]{2,}$/im;
let emuMethods = {};
emuMethods.POWER_AC_STATES = {
  POWER_AC_ON: 'on',
  POWER_AC_OFF: 'off'
};
emuMethods.GSM_CALL_ACTIONS = {
  GSM_CALL: 'call',
  GSM_ACCEPT: 'accept',
  GSM_CANCEL: 'cancel',
  GSM_HOLD: 'hold'
};
emuMethods.GSM_VOICE_STATES = {
  GSM_VOICE_UNREGISTERED: 'unregistered',
  GSM_VOICE_HOME: 'home',
  GSM_VOICE_ROAMING: 'roaming',
  GSM_VOICE_SEARCHING: 'searching',
  GSM_VOICE_DENIED: 'denied',
  GSM_VOICE_OFF: 'off',
  GSM_VOICE_ON: 'on'
};
emuMethods.GSM_SIGNAL_STRENGTHS = [0, 1, 2, 3, 4];
emuMethods.NETWORK_SPEED = {
  GSM: 'gsm',
  SCSD: 'scsd',
  GPRS: 'gprs',
  EDGE: 'edge',
  UMTS: 'umts',
  HSDPA: 'hsdpa',
  LTE: 'lte',
  EVDO: 'evdo',
  FULL: 'full'
};
emuMethods.isEmulatorConnected = (0, _asyncToGenerator2.default)(function* () {
  let emulators = yield this.getConnectedEmulators();
  return !!_lodash.default.find(emulators, x => x && x.udid === this.curDeviceId);
});
emuMethods.verifyEmulatorConnected = (0, _asyncToGenerator2.default)(function* () {
  if (!(yield this.isEmulatorConnected())) {
    throw new Error(`The emulator "${this.curDeviceId}" was unexpectedly disconnected`);
  }
});

emuMethods.fingerprint = function () {
  var _ref3 = (0, _asyncToGenerator2.default)(function* (fingerprintId) {
    if (!fingerprintId) {
      throw new Error('Fingerprint id parameter must be defined');
    }

    let level = yield this.getApiLevel();

    if (level < 23) {
      throw new Error(`Device API Level must be >= 23. Current Api level '${level}'`);
    }

    yield this.adbExecEmu(['finger', 'touch', fingerprintId]);
  });

  return function (_x) {
    return _ref3.apply(this, arguments);
  };
}();

emuMethods.rotate = (0, _asyncToGenerator2.default)(function* () {
  yield this.adbExecEmu(['rotate']);
});

emuMethods.powerAC = function () {
  var _ref5 = (0, _asyncToGenerator2.default)(function* (state = 'on') {
    if (_lodash.default.values(emuMethods.POWER_AC_STATES).indexOf(state) === -1) {
      throw new Error(`Wrong power AC state sent '${state}'. Supported values: ${_lodash.default.values(emuMethods.POWER_AC_STATES)}]`);
    }

    yield this.adbExecEmu(['power', 'ac', state]);
  });

  return function () {
    return _ref5.apply(this, arguments);
  };
}();

emuMethods.powerCapacity = function () {
  var _ref6 = (0, _asyncToGenerator2.default)(function* (percent = 100) {
    percent = parseInt(percent, 10);

    if (isNaN(percent) || percent < 0 || percent > 100) {
      throw new Error(`The percentage value should be valid integer between 0 and 100`);
    }

    yield this.adbExecEmu(['power', 'capacity', percent]);
  });

  return function () {
    return _ref6.apply(this, arguments);
  };
}();

emuMethods.powerOFF = (0, _asyncToGenerator2.default)(function* () {
  yield this.powerAC(emuMethods.POWER_AC_STATES.POWER_AC_OFF);
  yield this.powerCapacity(0);
});

emuMethods.sendSMS = function () {
  var _ref8 = (0, _asyncToGenerator2.default)(function* (phoneNumber, message = '') {
    message = message.trim();

    if (message === "") {
      throw new Error('Sending an SMS requires a message');
    }

    phoneNumber = `${phoneNumber}`.replace(/\s*/, "");

    if (!PHONE_NUMBER_PATTERN.test(phoneNumber)) {
      throw new Error(`Invalid sendSMS phoneNumber param ${phoneNumber}`);
    }

    yield this.adbExecEmu(['sms', 'send', phoneNumber, message]);
  });

  return function (_x2) {
    return _ref8.apply(this, arguments);
  };
}();

emuMethods.gsmCall = function () {
  var _ref9 = (0, _asyncToGenerator2.default)(function* (phoneNumber, action = '') {
    if (_lodash.default.values(emuMethods.GSM_CALL_ACTIONS).indexOf(action) === -1) {
      throw new Error(`Invalid gsm action param ${action}. Supported values: ${_lodash.default.values(emuMethods.GSM_CALL_ACTIONS)}`);
    }

    phoneNumber = `${phoneNumber}`.replace(/\s*/, "");

    if (!PHONE_NUMBER_PATTERN.test(phoneNumber)) {
      throw new Error(`Invalid gsmCall phoneNumber param ${phoneNumber}`);
    }

    yield this.adbExecEmu(['gsm', action, phoneNumber]);
  });

  return function (_x3) {
    return _ref9.apply(this, arguments);
  };
}();

emuMethods.gsmSignal = function () {
  var _ref10 = (0, _asyncToGenerator2.default)(function* (strength = 4) {
    strength = parseInt(strength, 10);

    if (emuMethods.GSM_SIGNAL_STRENGTHS.indexOf(strength) === -1) {
      throw new Error(`Invalid signal strength param ${strength}. Supported values: ${_lodash.default.values(emuMethods.GSM_SIGNAL_STRENGTHS)}`);
    }

    _logger.default.info('gsm signal-profile <strength> changes the reported strength on next (15s) update.');

    yield this.adbExecEmu(['gsm', 'signal-profile', strength]);
  });

  return function () {
    return _ref10.apply(this, arguments);
  };
}();

emuMethods.gsmVoice = function () {
  var _ref11 = (0, _asyncToGenerator2.default)(function* (state = 'on') {
    if (_lodash.default.values(emuMethods.GSM_VOICE_STATES).indexOf(state) === -1) {
      throw new Error(`Invalid gsm voice state param ${state}. Supported values: ${_lodash.default.values(emuMethods.GSM_VOICE_STATES)}`);
    }

    yield this.adbExecEmu(['gsm', 'voice', state]);
  });

  return function () {
    return _ref11.apply(this, arguments);
  };
}();

emuMethods.networkSpeed = function () {
  var _ref12 = (0, _asyncToGenerator2.default)(function* (speed = 'full') {
    if (_lodash.default.values(emuMethods.NETWORK_SPEED).indexOf(speed) === -1) {
      throw new Error(`Invalid network speed param ${speed}. Supported values: ${_lodash.default.values(emuMethods.NETWORK_SPEED)}`);
    }

    yield this.adbExecEmu(['network', 'speed', speed]);
  });

  return function () {
    return _ref12.apply(this, arguments);
  };
}();

var _default = emuMethods;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi90b29scy9hZGItZW11LWNvbW1hbmRzLmpzIl0sIm5hbWVzIjpbIlBIT05FX05VTUJFUl9QQVRURVJOIiwiZW11TWV0aG9kcyIsIlBPV0VSX0FDX1NUQVRFUyIsIlBPV0VSX0FDX09OIiwiUE9XRVJfQUNfT0ZGIiwiR1NNX0NBTExfQUNUSU9OUyIsIkdTTV9DQUxMIiwiR1NNX0FDQ0VQVCIsIkdTTV9DQU5DRUwiLCJHU01fSE9MRCIsIkdTTV9WT0lDRV9TVEFURVMiLCJHU01fVk9JQ0VfVU5SRUdJU1RFUkVEIiwiR1NNX1ZPSUNFX0hPTUUiLCJHU01fVk9JQ0VfUk9BTUlORyIsIkdTTV9WT0lDRV9TRUFSQ0hJTkciLCJHU01fVk9JQ0VfREVOSUVEIiwiR1NNX1ZPSUNFX09GRiIsIkdTTV9WT0lDRV9PTiIsIkdTTV9TSUdOQUxfU1RSRU5HVEhTIiwiTkVUV09SS19TUEVFRCIsIkdTTSIsIlNDU0QiLCJHUFJTIiwiRURHRSIsIlVNVFMiLCJIU0RQQSIsIkxURSIsIkVWRE8iLCJGVUxMIiwiaXNFbXVsYXRvckNvbm5lY3RlZCIsImVtdWxhdG9ycyIsImdldENvbm5lY3RlZEVtdWxhdG9ycyIsIl8iLCJmaW5kIiwieCIsInVkaWQiLCJjdXJEZXZpY2VJZCIsInZlcmlmeUVtdWxhdG9yQ29ubmVjdGVkIiwiRXJyb3IiLCJmaW5nZXJwcmludCIsImZpbmdlcnByaW50SWQiLCJsZXZlbCIsImdldEFwaUxldmVsIiwiYWRiRXhlY0VtdSIsInJvdGF0ZSIsInBvd2VyQUMiLCJzdGF0ZSIsInZhbHVlcyIsImluZGV4T2YiLCJwb3dlckNhcGFjaXR5IiwicGVyY2VudCIsInBhcnNlSW50IiwiaXNOYU4iLCJwb3dlck9GRiIsInNlbmRTTVMiLCJwaG9uZU51bWJlciIsIm1lc3NhZ2UiLCJ0cmltIiwicmVwbGFjZSIsInRlc3QiLCJnc21DYWxsIiwiYWN0aW9uIiwiZ3NtU2lnbmFsIiwic3RyZW5ndGgiLCJsb2ciLCJpbmZvIiwiZ3NtVm9pY2UiLCJuZXR3b3JrU3Bl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Q0QsVUFBTSxLQUFLaUMsVUFBTCxDQUFnQixDQUFDLEtBQUQsRUFBUSxPQUFSLEVBQWlCRyxLQUFqQixDQUFoQixDQUFOO0FBQ0QsR0FORDs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFjQTdDLFVBQVUsQ0FBQ2tFLFlBQVg7QUFBQSwrQ0FBMEIsV0FBZ0JDLEtBQUssR0FBRyxNQUF4QixFQUFnQztBQUV4RCxRQUFJcEMsZ0JBQUVlLE1BQUYsQ0FBUzlDLFVBQVUsQ0FBQ2tCLGFBQXBCLEVBQW1DNkIsT0FBbkMsQ0FBMkNvQixLQUEzQyxNQUFzRCxDQUFDLENBQTNELEVBQThEO0FBQzVELFlBQU0sSUFBSTlCLEtBQUosQ0FBVywrQkFBOEI4QixLQUFNLHVCQUFzQnBDLGdCQUFFZSxNQUFGLENBQVM5QyxVQUFVLENBQUNrQixhQUFwQixDQUFtQyxFQUF4RyxDQUFOO0FBQ0Q7O0FBQ0QsVUFBTSxLQUFLd0IsVUFBTCxDQUFnQixDQUFDLFNBQUQsRUFBWSxPQUFaLEVBQXFCeUIsS0FBckIsQ0FBaEIsQ0FBTjtBQUNELEdBTkQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O2VBUWVuRSxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGxvZyBmcm9tICcuLi9sb2dnZXIuanMnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuXG5jb25zdCBQSE9ORV9OVU1CRVJfUEFUVEVSTiA9IC9eWytdP1soXT9bMC05XSpbKV0/Wy1cXHMuXT9bMC05XSpbLVxccy5dP1swLTldezIsfSQvaW07XG5cbmxldCBlbXVNZXRob2RzID0ge307XG5lbXVNZXRob2RzLlBPV0VSX0FDX1NUQVRFUyA9IHtcbiAgUE9XRVJfQUNfT046ICdvbicsXG4gIFBPV0VSX0FDX09GRjogJ29mZidcbn07XG5lbXVNZXRob2RzLkdTTV9DQUxMX0FDVElPTlMgPSB7XG4gIEdTTV9DQUxMOiAnY2FsbCcsXG4gIEdTTV9BQ0NFUFQ6ICdhY2NlcHQnLFxuICBHU01fQ0FOQ0VMOiAnY2FuY2VsJyxcbiAgR1NNX0hPTEQ6ICdob2xkJ1xufTtcbmVtdU1ldGhvZHMuR1NNX1ZPSUNFX1NUQVRFUyA9IHtcbiAgR1NNX1ZPSUNFX1VOUkVHSVNURVJFRDogJ3VucmVnaXN0ZXJlZCcsXG4gIEdTTV9WT0lDRV9IT01FOiAnaG9tZScsXG4gIEdTTV9WT0lDRV9ST0FNSU5HOiAncm9hbWluZycsXG4gIEdTTV9WT0lDRV9TRUFSQ0hJTkc6ICdzZWFyY2hpbmcnLFxuICBHU01fVk9JQ0VfREVOSUVEOiAnZGVuaWVkJyxcbiAgR1NNX1ZPSUNFX09GRjogJ29mZicsXG4gIEdTTV9WT0lDRV9PTjogJ29uJ1xufTtcbmVtdU1ldGhvZHMuR1NNX1NJR05BTF9TVFJFTkdUSFMgPSBbMCwgMSwgMiwgMywgNF07XG5cbmVtdU1ldGhvZHMuTkVUV09SS19TUEVFRCA9IHtcbiAgR1NNOiAnZ3NtJywgLy8gR1NNL0NTRCAodXA6IDE0LjQsIGRvd246IDE0LjQpLlxuICBTQ1NEOiAnc2NzZCcsIC8vIEhTQ1NEICh1cDogMTQuNCwgZG93bjogNTcuNikuXG4gIEdQUlM6ICdncHJzJywgLy8gR1BSUyAodXA6IDI4LjgsIGRvd246IDU3LjYpLlxuICBFREdFOiAnZWRnZScsIC8vIEVER0UvRUdQUlMgKHVwOiA0NzMuNiwgZG93bjogNDczLjYpLlxuICBVTVRTOiAndW10cycsIC8vIFVNVFMvM0cgKHVwOiAzODQuMCwgZG93bjogMzg0LjApLlxuICBIU0RQQTogJ2hzZHBhJywgLy8gSFNEUEEgKHVwOiA1NzYwLjAsIGRvd246IDEzLDk4MC4wKS5cbiAgTFRFOiAnbHRlJywgLy8gTFRFICh1cDogNTgsMDAwLCBkb3duOiAxNzMsMDAwKS5cbiAgRVZETzogJ2V2ZG8nLCAvLyBFVkRPICh1cDogNzUsMDAwLCBkb3duOiAyODAsMDAwKS5cbiAgRlVMTDogJ2Z1bGwnIC8vIE5vIGxpbWl0LCB0aGUgZGVmYXVsdCAodXA6IDAuMCwgZG93bjogMC4wKS5cbn07XG5cbi8qKlxuICogQ2hlY2sgdGhlIGVtdWxhdG9yIHN0YXRlLlxuICpcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgRW11bGF0b3IgaXMgdmlzaWJsZSB0byBhZGIuXG4gKi9cbmVtdU1ldGhvZHMuaXNFbXVsYXRvckNvbm5lY3RlZCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgbGV0IGVtdWxhdG9ycyA9IGF3YWl0IHRoaXMuZ2V0Q29ubmVjdGVkRW11bGF0b3JzKCk7XG4gIHJldHVybiAhIV8uZmluZChlbXVsYXRvcnMsICh4KSA9PiB4ICYmIHgudWRpZCA9PT0gdGhpcy5jdXJEZXZpY2VJZCk7XG59O1xuXG4vKipcbiAqIFZlcmlmeSB0aGUgZW11bGF0b3IgaXMgY29ubmVjdGVkLlxuICpcbiAqIEB0aHJvd3Mge2Vycm9yfSBJZiBFbXVsYXRvciBpcyBub3QgdmlzaWJsZSB0byBhZGIuXG4gKi9cbmVtdU1ldGhvZHMudmVyaWZ5RW11bGF0b3JDb25uZWN0ZWQgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGlmICghKGF3YWl0IHRoaXMuaXNFbXVsYXRvckNvbm5lY3RlZCgpKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGVtdWxhdG9yIFwiJHt0aGlzLmN1ckRldmljZUlkfVwiIHdhcyB1bmV4cGVjdGVkbHkgZGlzY29ubmVjdGVkYCk7XG4gIH1cbn07XG5cbi8qKlxuICogRW11bGF0ZSBmaW5nZXJwcmludCB0b3VjaCBldmVudCBvbiB0aGUgY29ubmVjdGVkIGVtdWxhdG9yLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBmaW5nZXJwcmludElkIC0gVGhlIElEIG9mIHRoZSBmaW5nZXJwcmludC5cbiAqL1xuZW11TWV0aG9kcy5maW5nZXJwcmludCA9IGFzeW5jIGZ1bmN0aW9uIChmaW5nZXJwcmludElkKSB7XG4gIGlmICghZmluZ2VycHJpbnRJZCkge1xuICAgIHRocm93IG5ldyBFcnJvcignRmluZ2VycHJpbnQgaWQgcGFyYW1ldGVyIG11c3QgYmUgZGVmaW5lZCcpO1xuICB9XG4gIC8vIHRoZSBtZXRob2QgdXNlZCBvbmx5IHdvcmtzIGZvciBBUEkgbGV2ZWwgMjMgYW5kIGFib3ZlXG4gIGxldCBsZXZlbCA9IGF3YWl0IHRoaXMuZ2V0QXBpTGV2ZWwoKTtcbiAgaWYgKGxldmVsIDwgMjMpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYERldmljZSBBUEkgTGV2ZWwgbXVzdCBiZSA+PSAyMy4gQ3VycmVudCBBcGkgbGV2ZWwgJyR7bGV2ZWx9J2ApO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiRXhlY0VtdShbJ2ZpbmdlcicsICd0b3VjaCcsIGZpbmdlcnByaW50SWRdKTtcbn07XG5cbi8qKlxuICogQ2hhbmdlIHRoZSBkaXNwbGF5IG9yaWVudGF0aW9uIG9uIHRoZSBjb25uZWN0ZWQgZW11bGF0b3IuXG4gKiBUaGUgb3JpZW50YXRpb24gaXMgY2hhbmdlZCAoUEkvMiBpcyBhZGRlZCkgZXZlcnkgdGltZVxuICogdGhpcyBtZXRob2QgaXMgY2FsbGVkLlxuICovXG5lbXVNZXRob2RzLnJvdGF0ZSA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgYXdhaXQgdGhpcy5hZGJFeGVjRW11KFsncm90YXRlJ10pO1xufTtcblxuLyoqXG4gKiBFbXVsYXRlIHBvd2VyIHN0YXRlIGNoYW5nZSBvbiB0aGUgY29ubmVjdGVkIGVtdWxhdG9yLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdGF0ZSBbJ29uJ10gLSBFaXRoZXIgJ29uJyBvciAnb2ZmJy5cbiAqL1xuZW11TWV0aG9kcy5wb3dlckFDID0gYXN5bmMgZnVuY3Rpb24gKHN0YXRlID0gJ29uJykge1xuICBpZiAoXy52YWx1ZXMoZW11TWV0aG9kcy5QT1dFUl9BQ19TVEFURVMpLmluZGV4T2Yoc3RhdGUpID09PSAtMSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgV3JvbmcgcG93ZXIgQUMgc3RhdGUgc2VudCAnJHtzdGF0ZX0nLiBTdXBwb3J0ZWQgdmFsdWVzOiAke18udmFsdWVzKGVtdU1ldGhvZHMuUE9XRVJfQUNfU1RBVEVTKX1dYCk7XG4gIH1cbiAgYXdhaXQgdGhpcy5hZGJFeGVjRW11KFsncG93ZXInLCAnYWMnLCBzdGF0ZV0pO1xufTtcblxuLyoqXG4gKiBFbXVsYXRlIHBvd2VyIGNhcGFjaXR5IGNoYW5nZSBvbiB0aGUgY29ubmVjdGVkIGVtdWxhdG9yLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gcGVyY2VudCBbMTAwXSAtIFBlcmNlbnRhZ2UgdmFsdWUgaW4gcmFuZ2UgWzAsIDEwMF0uXG4gKi9cbmVtdU1ldGhvZHMucG93ZXJDYXBhY2l0eSA9IGFzeW5jIGZ1bmN0aW9uIChwZXJjZW50ID0gMTAwKSB7XG4gIHBlcmNlbnQgPSBwYXJzZUludChwZXJjZW50LCAxMCk7XG4gIGlmIChpc05hTihwZXJjZW50KSB8fCBwZXJjZW50IDwgMCB8fCBwZXJjZW50ID4gMTAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgcGVyY2VudGFnZSB2YWx1ZSBzaG91bGQgYmUgdmFsaWQgaW50ZWdlciBiZXR3ZWVuIDAgYW5kIDEwMGApO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiRXhlY0VtdShbJ3Bvd2VyJywgJ2NhcGFjaXR5JywgcGVyY2VudF0pO1xufTtcblxuLyoqXG4gKiBFbXVsYXRlIHBvd2VyIG9mZiBldmVudCBvbiB0aGUgY29ubmVjdGVkIGVtdWxhdG9yLlxuICovXG5lbXVNZXRob2RzLnBvd2VyT0ZGID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBhd2FpdCB0aGlzLnBvd2VyQUMoZW11TWV0aG9kcy5QT1dFUl9BQ19TVEFURVMuUE9XRVJfQUNfT0ZGKTtcbiAgYXdhaXQgdGhpcy5wb3dlckNhcGFjaXR5KDApO1xufTtcblxuLyoqXG4gKiBFbXVsYXRlIHNlbmQgU01TIGV2ZW50IG9uIHRoZSBjb25uZWN0ZWQgZW11bGF0b3IuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBwaG9uZU51bWJlciAtIFRoZSBwaG9uZSBudW1iZXIgb2YgbWVzc2FnZSBzZW5kZXIuXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSBbJyddIC0gVGhlIG1lc3NhZ2UgY29udGVudC5cbiAqIEB0aHJvd3Mge2Vycm9yfSBJZiBwaG9uZSBudW1iZXIgaGFzIGludmFsaWQgZm9ybWF0LlxuICovXG5lbXVNZXRob2RzLnNlbmRTTVMgPSBhc3luYyBmdW5jdGlvbiAocGhvbmVOdW1iZXIsIG1lc3NhZ2UgPSAnJykge1xuICBtZXNzYWdlID0gbWVzc2FnZS50cmltKCk7XG4gIGlmIChtZXNzYWdlID09PSBcIlwiKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdTZW5kaW5nIGFuIFNNUyByZXF1aXJlcyBhIG1lc3NhZ2UnKTtcbiAgfVxuICBwaG9uZU51bWJlciA9IGAke3Bob25lTnVtYmVyfWAucmVwbGFjZSgvXFxzKi8sIFwiXCIpO1xuICBpZiAoIVBIT05FX05VTUJFUl9QQVRURVJOLnRlc3QocGhvbmVOdW1iZXIpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHNlbmRTTVMgcGhvbmVOdW1iZXIgcGFyYW0gJHtwaG9uZU51bWJlcn1gKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYkV4ZWNFbXUoWydzbXMnLCAnc2VuZCcsIHBob25lTnVtYmVyLCBtZXNzYWdlXSk7XG59O1xuXG4vKipcbiAqIEVtdWxhdGUgR1NNIGNhbGwgZXZlbnQgb24gdGhlIGNvbm5lY3RlZCBlbXVsYXRvci5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9IHBob25lTnVtYmVyIC0gVGhlIHBob25lIG51bWJlciBvZiB0aGUgY2FsbGVyLlxuICogQHBhcmFtIHtzdHJpbmd9IGFjdGlvbiBbJyddIC0gT25lIG9mIGF2YWlsYWJsZSBHU00gY2FsbCBhY3Rpb25zLlxuICogQHRocm93cyB7ZXJyb3J9IElmIHBob25lIG51bWJlciBoYXMgaW52YWxpZCBmb3JtYXQuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgX2FjdGlvbl8gdmFsdWUgaXMgaW52YWxpZC5cbiAqL1xuZW11TWV0aG9kcy5nc21DYWxsID0gYXN5bmMgZnVuY3Rpb24gKHBob25lTnVtYmVyLCBhY3Rpb24gPSAnJykge1xuICBpZiAoXy52YWx1ZXMoZW11TWV0aG9kcy5HU01fQ0FMTF9BQ1RJT05TKS5pbmRleE9mKGFjdGlvbikgPT09IC0xKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGdzbSBhY3Rpb24gcGFyYW0gJHthY3Rpb259LiBTdXBwb3J0ZWQgdmFsdWVzOiAke18udmFsdWVzKGVtdU1ldGhvZHMuR1NNX0NBTExfQUNUSU9OUyl9YCk7XG4gIH1cbiAgcGhvbmVOdW1iZXIgPSBgJHtwaG9uZU51bWJlcn1gLnJlcGxhY2UoL1xccyovLCBcIlwiKTtcbiAgaWYgKCFQSE9ORV9OVU1CRVJfUEFUVEVSTi50ZXN0KHBob25lTnVtYmVyKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBnc21DYWxsIHBob25lTnVtYmVyIHBhcmFtICR7cGhvbmVOdW1iZXJ9YCk7XG4gIH1cbiAgYXdhaXQgdGhpcy5hZGJFeGVjRW11KFsnZ3NtJywgYWN0aW9uLCBwaG9uZU51bWJlcl0pO1xufTtcblxuLyoqXG4gKiBFbXVsYXRlIEdTTSBzaWduYWwgc3RyZW5ndGggY2hhbmdlIGV2ZW50IG9uIHRoZSBjb25uZWN0ZWQgZW11bGF0b3IuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBzdHJlbmd0aCBbNF0gLSBBIG51bWJlciBpbiByYW5nZSBbMCwgNF07XG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgX3N0cmVuZ3RoXyB2YWx1ZSBpcyBpbnZhbGlkLlxuICovXG5lbXVNZXRob2RzLmdzbVNpZ25hbCA9IGFzeW5jIGZ1bmN0aW9uIChzdHJlbmd0aCA9IDQpIHtcbiAgc3RyZW5ndGggPSBwYXJzZUludChzdHJlbmd0aCwgMTApO1xuICBpZiAoZW11TWV0aG9kcy5HU01fU0lHTkFMX1NUUkVOR1RIUy5pbmRleE9mKHN0cmVuZ3RoKSA9PT0gLTEpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgc2lnbmFsIHN0cmVuZ3RoIHBhcmFtICR7c3RyZW5ndGh9LiBTdXBwb3J0ZWQgdmFsdWVzOiAke18udmFsdWVzKGVtdU1ldGhvZHMuR1NNX1NJR05BTF9TVFJFTkdUSFMpfWApO1xuICB9XG4gIGxvZy5pbmZvKCdnc20gc2lnbmFsLXByb2ZpbGUgPHN0cmVuZ3RoPiBjaGFuZ2VzIHRoZSByZXBvcnRlZCBzdHJlbmd0aCBvbiBuZXh0ICgxNXMpIHVwZGF0ZS4nKTtcbiAgYXdhaXQgdGhpcy5hZGJFeGVjRW11KFsnZ3NtJywgJ3NpZ25hbC1wcm9maWxlJywgc3RyZW5ndGhdKTtcbn07XG5cbi8qKlxuICogRW11bGF0ZSBHU00gdm9pY2UgZXZlbnQgb24gdGhlIGNvbm5lY3RlZCBlbXVsYXRvci5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RhdGUgWydvbiddIC0gRWl0aGVyICdvbicgb3IgJ29mZicuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgX3N0YXRlXyB2YWx1ZSBpcyBpbnZhbGlkLlxuICovXG5lbXVNZXRob2RzLmdzbVZvaWNlID0gYXN5bmMgZnVuY3Rpb24gKHN0YXRlID0gJ29uJykge1xuICAvLyBnc20gdm9pY2UgPHN0YXRlPiBhbGxvd3MgeW91IHRvIGNoYW5nZSB0aGUgc3RhdGUgb2YgeW91ciBHUFJTIGNvbm5lY3Rpb25cbiAgaWYgKF8udmFsdWVzKGVtdU1ldGhvZHMuR1NNX1ZPSUNFX1NUQVRFUykuaW5kZXhPZihzdGF0ZSkgPT09IC0xKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGdzbSB2b2ljZSBzdGF0ZSBwYXJhbSAke3N0YXRlfS4gU3VwcG9ydGVkIHZhbHVlczogJHtfLnZhbHVlcyhlbXVNZXRob2RzLkdTTV9WT0lDRV9TVEFURVMpfWApO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiRXhlY0VtdShbJ2dzbScsICd2b2ljZScsIHN0YXRlXSk7XG59O1xuXG4vKipcbiAqIEVtdWxhdGUgbmV0d29yayBzcGVlZCBjaGFuZ2UgZXZlbnQgb24gdGhlIGNvbm5lY3RlZCBlbXVsYXRvci5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gc3BlZWQgWydmdWxsJ10gLSBPbmUgb2YgcG9zc2libGUgTkVUV09SS19TUEVFRCB2YWx1ZXMuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgX3NwZWVkXyB2YWx1ZSBpcyBpbnZhbGlkLlxuICovXG5lbXVNZXRob2RzLm5ldHdvcmtTcGVlZCA9IGFzeW5jIGZ1bmN0aW9uIChzcGVlZCA9ICdmdWxsJykge1xuICAvLyBuZXR3b3JrIHNwZWVkIDxzcGVlZD4gYWxsb3dzIHlvdSB0byBzZXQgdGhlIG5ldHdvcmsgc3BlZWQgZW11bGF0aW9uLlxuICBpZiAoXy52YWx1ZXMoZW11TWV0aG9kcy5ORVRXT1JLX1NQRUVEKS5pbmRleE9mKHNwZWVkKSA9PT0gLTEpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgbmV0d29yayBzcGVlZCBwYXJhbSAke3NwZWVkfS4gU3VwcG9ydGVkIHZhbHVlczogJHtfLnZhbHVlcyhlbXVNZXRob2RzLk5FVFdPUktfU1BFRUQpfWApO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiRXhlY0VtdShbJ25ldHdvcmsnLCAnc3BlZWQnLCBzcGVlZF0pO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgZW11TWV0aG9kcztcbiJdLCJmaWxlIjoibGliL3Rvb2xzL2FkYi1lbXUtY29tbWFuZHMuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
